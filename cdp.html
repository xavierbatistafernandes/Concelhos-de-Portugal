<!DOCTYPE html>
<html>
    <head>
        <title>Concelhos de Portugal</title>

        <link rel="stylesheet" href="/webpage/css/leaflet.css">
        <link rel="stylesheet" href="/webpage/css/cdp.css">

        <script src="/webpage/js/leaflet.js"></script>

        <!--<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css">-->
        <!--<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>-->


    </head>
    <body>
        <h1>Aprende os Concelhos de Portugal!</h1>
        <div id="map"></div>
        <div id="menu">
            <input id="btn-add-layers" class="menu-btn" type="button" value="Carregar fronteiras"> <br>
            <input id="btn-del-layers" class="menu-btn" type="button" value="Apagar fronteiras">
        </div>

        <script>
            
            /* 
            L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", 
                {attribution: "&copy; OpenStreetMap"}
                ).addTo(map);
                */
               
               /* Adding background layer to the map */
            let options = {center: [38.43421787890949, -16.044627815603235], zoom: 4};
            let map = L.map("map", options);
            L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
                attribution: "&copy; OpenStreetMap",
                subdomains: 'abcd',
                minZoom: 1,
                maxZoom: 16,
                ext: 'jpg'
            }).addTo(map);


            /* Loading borders of municipalities */
            let geojson;
            let layers = L.layerGroup().addTo(map);
            //addLayers();
            let colorArray = ['#67001f',
                              '#b2182b',
                              '#d6604d',
                              '#f4a582',
                              '#fddbc7',
                              '#f7f7f7',
                              '#d1e5f0',
                              '#92c5de',
                              '#4393c3',
                              '#2166ac',
                              '#053061'];

            function borders_color(p) {
                switch(p) {
                    case "Aveiro":           return "#ffffd9"; break;
                    case "Beja":             return "#edf8b1"; break;
                    case "Braga":            return "#c7e9b4"; break;
                    case "Bragança":         return "#7fcdbb"; break;
                    case "Castelo Branco":   return "#41b6c4"; break;
                    case "Coimbra":          return "#1d91c0"; break;
                    case "Évora":            return "#225ea8"; break;
                    case "Faro":             return "#253494"; break;
                    case "Guarda":           return "#081d58"; break;
                    case "Leiria":           return colorArray[0]; break;
                    case "Lisboa":           return colorArray[1]; break;
                    case "Portalegre":       return colorArray[2]; break;
                    case "Porto":            return colorArray[3]; break;
                    case "Santarém":         return colorArray[4]; break;
                    case "Setúbal":          return colorArray[5]; break;
                    case "Viana do Castelo": return colorArray[6]; break;
                    case "Vila Real":        return colorArray[7]; break;
                    case "Viseu":            return colorArray[8]; break;
                    default:                 return "black";
                }
            }
            
            function borders_style(feature) {
                return {
                    color: "black",
                    weight: 1,
                    fillColor: borders_color(feature.properties.NAME_1),
                    fillOpacity: 0.7
                };
            }

            function borders_onEachFeature(feature, layer) {
                layer.addEventListener("mouseover", featureMouseOver);
                layer.addEventListener("mouseout", featureMouseOut);
            }


            let highlightStyle = {
                weight: 3,
                color: "black",
                fillOpacity: 1
            };

            function featureMouseOver(e) {
                e.target.setStyle(highlightStyle);
                e.target.bringToFront();
            }

            function featureMouseOut(e) {
                geojson.resetStyle(e.target);
            }

            /* Menu buttons load and delete layers */
            function addLayers() {
                fetch("/webpage/data/layers.geojson")
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(data) {  // add GeoJSON layer to the map once the file is loaded
                        geojson = L.geoJSON(data, {style: borders_style, onEachFeature: borders_onEachFeature}).addTo(layers);
                    });
            }
            function delLayers() {
                layers.clearLayers();
            }

            document.getElementById("btn-add-layers").addEventListener("click", addLayers);
            document.getElementById("btn-del-layers").addEventListener("click", delLayers);
            
            let marker = L.marker([38.43421787890949, -16.044627815603235]);
            marker.addTo(map);
            marker.bindPopup("Welcome to <b>Portugal</b>!");

            
            let popup = L.popup();

            function onMapClick(e) {
                popup
                    .setLatLng(e.latlng)
                    .setContent("lat: " + e.latlng.lat.toFixed(2) + "º<br>lon: " + e.latlng.lng.toFixed(2)+"º")
                    .openOn(map);
            }

            map.addEventListener("click", onMapClick);
            

        </script>
    </body>
</html>